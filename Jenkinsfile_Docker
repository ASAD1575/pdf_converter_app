pipeline {
    agent any

    environment {
        AWS_ACCOUNT_ID     = "375299695019"
        AWS_DEFAULT_REGION = "eu-north-1"
        AWS_SECRET_ACCESS_KEY = credentials('AWS_SECRET_ACCESS_KEY')
        AWS_ACCESS_KEY_ID  = credentials('AWS_ACCESS_KEY_ID')
        IMAGE_REPO_NAME    = "ecs-fargate"
        IMAGE_TAG          = "latest"
        REPOSITORY_URI     = "${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_DEFAULT_REGION}.amazonaws.com/${IMAGE_REPO_NAME}"
        CLUSTER_NAME       = "node-app-cluster"
        SERVICE_NAME       = "node-app-service"
    }
     
    stages {
        stage('Terraform Init & Apply') {
            agent {
                docker {
                    image 'hashicorp/terraform:1.5.7'
                    args '--entrypoint="" -u root:root'
                }
            }
            steps {
                script {
                    sh '''
                        terraform init
                        terraform destroy -auto-approve
                    '''
                    }
                
                }
        }

    }
}
